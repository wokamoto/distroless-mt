<VirtualHost *:80>
    ServerName   localhost
    DocumentRoot /var/www/html/htdocs

    LogFormat    "%a %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined-aws
    CustomLog    "/var/log/httpd/access_log" combined-aws
    ErrorLog     "/var/log/httpd/error_log"

    Alias        /mt-static /var/www/movabletype/mt-static
    TraceEnable  Off

    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} ^TRACK
    RewriteRule .* - [R=405,L]
    RewriteRule /\.(?!well-known).* - [R=404,L]
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ - [R=404,L]

    # Optional: enable when behind a proxy (requires mod_remoteip)
    # RemoteIPInternalProxy 10.0.0.0/8
    # RemoteIPHeader X-Forwarded-For
    # RemoteIPProxiesHeader X-Forwarded-For

    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]

    <Directory /var/www/html/htdocs>
        Options IncludesNOEXEC SymLinksIfOwnerMatch
        AllowOverride FileInfo AuthConfig Limit
        AddHandler server-parsed .html
        Require all granted
    </Directory>

    <Directory /var/www/movabletype/mt-static>
        Options -Indexes +FollowSymLinks
        Require all granted
    </Directory>

    ProxyRequests     Off
    ProxyPreserveHost On
    RequestHeader     set X-Forwarded-Proto "expr=%{REQUEST_SCHEME}"
    # /mt-static は Alias でローカル配信するためプロキシ対象外にする
    ProxyPass         /mt-static !
    ProxyPass         /mt/ http://127.0.0.1:5000/mt/
    ProxyPassReverse  /mt/ http://127.0.0.1:5000/mt/
    ProxyTimeout      900

    ErrorDocument 404 /404.html
    ErrorDocument 500 /500.html
    ErrorDocument 501 /500.html
    ErrorDocument 502 /500.html
    ErrorDocument 503 /500.html
</VirtualHost>
